import{u as N,p as j,c as o,a as t,d as v,F as V,j as A,t as p,b as f,v as y,x as B,q as x,k as E,r as n,o as i}from"./index-Cz2jkUhJ.js";const I={class:"p-6 space-y-4"},$={class:"flex items-center justify-between"},M={class:"bg-white rounded shadow divide-y"},T={class:"flex items-start justify-between gap-3"},U={class:"font-semibold"},F={class:"text-xs text-slate-500"},L={key:0,class:"shrink-0"},O=["onClick"],P=["onClick"],q={class:"text-sm text-slate-700 mt-2 whitespace-pre-line"},z={key:0,class:"p-4 text-slate-500"},G={key:0,class:"fixed inset-0 bg-black/40 flex items-center justify-center p-4"},H={class:"bg-white rounded shadow w-full max-w-lg p-4 space-y-3"},J={class:"flex items-center justify-between"},K={class:"font-semibold"},W={__name:"Index",setup(Q){const w=N(),_=E(()=>{var l;return((l=w.user)==null?void 0:l.role)==="admin"}),b=n([]),d=n(!1),c=n(null),a=n({title:"",body:"",publish_at:""}),u=n(""),r=n(!0);async function m(){b.value=(await x.get("/notices")).data}function g(){c.value=null,a.value={title:"",body:"",publish_at:""},u.value="",r.value=!0,d.value=!0}function k(l){c.value=l.id,a.value={title:l.title,body:l.body,publish_at:l.publish_at?new Date(l.publish_at).toISOString().slice(0,16):""},u.value="",r.value=!0,d.value=!0}function h(){d.value=!1}async function C(){var l,s;u.value="";try{const e={title:a.value.title,body:a.value.body,publish_at:a.value.publish_at?new Date(a.value.publish_at).toISOString():null};c.value?await x.put(`/notices/${c.value}`,e):await x.post("/notices",e),r.value=!0,u.value="Saved!",await m(),setTimeout(()=>d.value=!1,400)}catch(e){r.value=!1,u.value=((s=(l=e==null?void 0:e.response)==null?void 0:l.data)==null?void 0:s.message)||"Save failed"}}async function S(l){confirm("Delete notice?")&&(await x.delete(`/notices/${l.id}`),await m())}return j(m),(l,s)=>(i(),o("div",I,[t("div",$,[s[3]||(s[3]=t("h1",{class:"text-xl font-semibold"},"Notices",-1)),_.value?(i(),o("button",{key:0,class:"px-3 py-2 rounded bg-slate-900 text-white text-sm",onClick:g}," + Add Notice ")):v("",!0)]),t("div",M,[(i(!0),o(V,null,A(b.value,e=>(i(),o("div",{key:e.id,class:"p-4"},[t("div",T,[t("div",null,[t("div",U,p(e.title),1),t("div",F," Publish: "+p(e.publish_at?new Date(e.publish_at).toLocaleString():"draft"),1)]),_.value?(i(),o("div",L,[t("button",{class:"text-blue-700 text-sm",onClick:D=>k(e)},"Edit",8,O),s[4]||(s[4]=t("span",{class:"mx-2 text-slate-300"},"|",-1)),t("button",{class:"text-red-700 text-sm",onClick:D=>S(e)},"Delete",8,P)])):v("",!0)]),t("div",q,p(e.body),1)]))),128)),b.value.length===0?(i(),o("div",z,"No notices")):v("",!0)]),d.value?(i(),o("div",G,[t("div",H,[t("div",J,[t("h2",K,p(c.value?"Edit Notice":"Add Notice"),1),t("button",{class:"text-slate-600",onClick:h},"âœ•")]),t("div",null,[s[5]||(s[5]=t("label",{class:"text-xs text-slate-600"},"Title",-1)),f(t("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>a.value.title=e),class:"w-full border rounded px-3 py-2 text-sm"},null,512),[[y,a.value.title]])]),t("div",null,[s[6]||(s[6]=t("label",{class:"text-xs text-slate-600"},"Publish at (optional)",-1)),f(t("input",{type:"datetime-local","onUpdate:modelValue":s[1]||(s[1]=e=>a.value.publish_at=e),class:"w-full border rounded px-3 py-2 text-sm"},null,512),[[y,a.value.publish_at]])]),t("div",null,[s[7]||(s[7]=t("label",{class:"text-xs text-slate-600"},"Body",-1)),f(t("textarea",{"onUpdate:modelValue":s[2]||(s[2]=e=>a.value.body=e),class:"w-full border rounded px-3 py-2 text-sm",rows:"5"},null,512),[[y,a.value.body]])]),t("div",{class:"flex justify-end gap-2 pt-2"},[t("button",{class:"px-3 py-2 rounded border bg-white text-sm",onClick:h},"Cancel"),t("button",{class:"px-3 py-2 rounded bg-slate-900 text-white text-sm",onClick:C},"Save")]),u.value?(i(),o("p",{key:0,class:B(["text-sm",r.value?"text-green-700":"text-red-700"])},p(u.value),3)):v("",!0)])])):v("",!0)]))}};export{W as default};
