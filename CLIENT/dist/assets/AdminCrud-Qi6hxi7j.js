import{p as q,c as o,a as e,b as u,s as x,F as c,j as p,d as j,t as d,v as k,x as z,r,q as g,k as F,o as n}from"./index-Cz2jkUhJ.js";import{f as L}from"./masters-BuYwAPrL.js";const G={class:"p-6 space-y-4"},H={class:"bg-white rounded shadow p-4 grid gap-3 md:grid-cols-3"},J=["value"],K=["value"],P={class:"bg-white rounded shadow overflow-hidden"},Q={class:"w-full text-sm"},X={class:"p-3"},Y={class:"p-3"},Z={class:"p-3"},ee={class:"p-3"},te={class:"p-3"},se={class:"p-3"},le={class:"p-3"},ae={class:"p-3"},oe=["onClick"],ne=["onClick"],de={key:0},ue={key:0,class:"fixed inset-0 bg-black/40 flex items-center justify-center p-4"},ie={class:"bg-white rounded shadow w-full max-w-lg p-4 space-y-3"},re={class:"flex items-center justify-between"},ve={class:"font-semibold"},ce={class:"grid gap-3 md:grid-cols-2"},pe=["value"],me=["value"],xe=["value"],be={class:"md:col-span-2"},fe=["value"],_e={class:"md:col-span-2"},ge={__name:"AdminCrud",setup(ye){const i=r({classes:[],sections:[],subjects:[]}),S=r([]),m=r(0),y=r(0),b=r(!1),f=r(null),v=r(""),_=r(!0),M=[{v:1,t:"Mon"},{v:2,t:"Tue"},{v:3,t:"Wed"},{v:4,t:"Thu"},{v:5,t:"Fri"},{v:6,t:"Sat"},{v:7,t:"Sun"}],a=r({class_id:0,section_id:null,weekday:1,start_time:"09:00",end_time:"10:00",subject_id:0,teacher_id:null,room:""}),D=F(()=>m.value?i.value.sections.filter(l=>l.class_id===m.value):i.value.sections),E=F(()=>a.value.class_id?i.value.sections.filter(l=>l.class_id===a.value.class_id):[]);function N(l){return["","Mon","Tue","Wed","Thu","Fri","Sat","Sun"][l]||l}function I(){var l,t;a.value={class_id:((l=i.value.classes[0])==null?void 0:l.id)||0,section_id:null,weekday:1,start_time:"09:00",end_time:"10:00",subject_id:((t=i.value.subjects[0])==null?void 0:t.id)||0,teacher_id:null,room:""}}function R(){v.value="",_.value=!0,f.value=null,I(),b.value=!0}function $(l){v.value="",_.value=!0,f.value=l.id,a.value={class_id:l.class_id,section_id:l.section_id,weekday:l.weekday,start_time:l.start_time,end_time:l.end_time,subject_id:l.subject_id,teacher_id:l.teacher_id,room:l.room||""},b.value=!0}function C(){b.value=!1}async function w(){const l={};m.value&&(l.class_id=m.value),y.value&&(l.section_id=y.value);const{data:t}=await g.get("/routines",{params:l});S.value=t}async function B(){var l,t;v.value="";try{const s={...a.value};s.section_id||(s.section_id=null),s.teacher_id||(s.teacher_id=null),f.value?await g.put(`/routines/${f.value}`,s):await g.post("/routines",s),_.value=!0,v.value="Saved!",await w(),setTimeout(()=>b.value=!1,400)}catch(s){_.value=!1,v.value=((t=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:t.message)||"Save failed"}}async function W(l){confirm("Delete this slot?")&&(await g.delete(`/routines/${l.id}`),await w())}return q(async()=>{i.value=await L().catch(()=>({classes:[],sections:[],subjects:[]})),await w()}),(l,t)=>(n(),o("div",G,[e("div",{class:"flex items-center justify-between"},[t[10]||(t[10]=e("h1",{class:"text-xl font-semibold"},"Routine (Admin)",-1)),e("button",{class:"px-3 py-2 rounded bg-slate-900 text-white text-sm",onClick:R},"+ Add Slot")]),e("div",H,[e("div",null,[t[12]||(t[12]=e("label",{class:"text-xs text-slate-600"},"Class",-1)),u(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>m.value=s),class:"w-full border rounded px-3 py-2 text-sm"},[t[11]||(t[11]=e("option",{value:0},"All",-1)),(n(!0),o(c,null,p(i.value.classes,s=>(n(),o("option",{key:s.id,value:s.id},d(s.name),9,J))),128))],512),[[x,m.value,void 0,{number:!0}]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"text-xs text-slate-600"},"Section",-1)),u(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>y.value=s),class:"w-full border rounded px-3 py-2 text-sm"},[t[13]||(t[13]=e("option",{value:0},"All",-1)),(n(!0),o(c,null,p(D.value,s=>(n(),o("option",{key:s.id,value:s.id},d(s.name),9,K))),128))],512),[[x,y.value,void 0,{number:!0}]])]),e("div",{class:"flex items-end"},[e("button",{class:"px-3 py-2 rounded bg-white border text-sm w-full",onClick:w},"Refresh")])]),e("div",P,[e("table",Q,[t[17]||(t[17]=e("thead",{class:"bg-slate-50"},[e("tr",null,[e("th",{class:"text-left p-3"},"Day"),e("th",{class:"text-left p-3"},"Time"),e("th",{class:"text-left p-3"},"Class"),e("th",{class:"text-left p-3"},"Section"),e("th",{class:"text-left p-3"},"Subject"),e("th",{class:"text-left p-3"},"Teacher"),e("th",{class:"text-left p-3"},"Room"),e("th",{class:"text-left p-3"},"Action")])],-1)),e("tbody",null,[(n(!0),o(c,null,p(S.value,s=>{var h,T,V,U,A;return n(),o("tr",{key:s.id,class:"border-t"},[e("td",X,d(N(s.weekday)),1),e("td",Y,d(s.start_time)+" - "+d(s.end_time),1),e("td",Z,d((h=s.class)==null?void 0:h.name),1),e("td",ee,d(((T=s.section)==null?void 0:T.name)||"-"),1),e("td",te,d((V=s.subject)==null?void 0:V.name),1),e("td",se,d(((A=(U=s.teacher)==null?void 0:U.user)==null?void 0:A.name)||"-"),1),e("td",le,d(s.room||"-"),1),e("td",ae,[e("button",{class:"text-blue-700",onClick:O=>$(s)},"Edit",8,oe),t[15]||(t[15]=e("span",{class:"mx-2 text-slate-300"},"|",-1)),e("button",{class:"text-red-700",onClick:O=>W(s)},"Delete",8,ne)])])}),128)),S.value.length===0?(n(),o("tr",de,[...t[16]||(t[16]=[e("td",{class:"p-4 text-slate-500",colspan:"8"},"No routines",-1)])])):j("",!0)])])]),b.value?(n(),o("div",ue,[e("div",ie,[e("div",re,[e("h2",ve,d(f.value?"Edit Slot":"Add Slot"),1),e("button",{class:"text-slate-600",onClick:C},"âœ•")]),e("div",ce,[e("div",null,[t[19]||(t[19]=e("label",{class:"text-xs text-slate-600"},"Class",-1)),u(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>a.value.class_id=s),class:"w-full border rounded px-3 py-2 text-sm"},[t[18]||(t[18]=e("option",{disabled:"",value:0},"Select class",-1)),(n(!0),o(c,null,p(i.value.classes,s=>(n(),o("option",{key:s.id,value:s.id},d(s.name),9,pe))),128))],512),[[x,a.value.class_id,void 0,{number:!0}]])]),e("div",null,[t[21]||(t[21]=e("label",{class:"text-xs text-slate-600"},"Section",-1)),u(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>a.value.section_id=s),class:"w-full border rounded px-3 py-2 text-sm"},[t[20]||(t[20]=e("option",{value:null},"None",-1)),(n(!0),o(c,null,p(E.value,s=>(n(),o("option",{key:s.id,value:s.id},d(s.name),9,me))),128))],512),[[x,a.value.section_id,void 0,{number:!0}]])]),e("div",null,[t[22]||(t[22]=e("label",{class:"text-xs text-slate-600"},"Weekday",-1)),u(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>a.value.weekday=s),class:"w-full border rounded px-3 py-2 text-sm"},[(n(),o(c,null,p(M,s=>e("option",{key:s.v,value:s.v},d(s.t),9,xe)),64))],512),[[x,a.value.weekday,void 0,{number:!0}]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"text-xs text-slate-600"},"Room",-1)),u(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>a.value.room=s),class:"w-full border rounded px-3 py-2 text-sm"},null,512),[[k,a.value.room]])]),e("div",null,[t[24]||(t[24]=e("label",{class:"text-xs text-slate-600"},"Start",-1)),u(e("input",{type:"time","onUpdate:modelValue":t[6]||(t[6]=s=>a.value.start_time=s),class:"w-full border rounded px-3 py-2 text-sm"},null,512),[[k,a.value.start_time]])]),e("div",null,[t[25]||(t[25]=e("label",{class:"text-xs text-slate-600"},"End",-1)),u(e("input",{type:"time","onUpdate:modelValue":t[7]||(t[7]=s=>a.value.end_time=s),class:"w-full border rounded px-3 py-2 text-sm"},null,512),[[k,a.value.end_time]])]),e("div",be,[t[27]||(t[27]=e("label",{class:"text-xs text-slate-600"},"Subject",-1)),u(e("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>a.value.subject_id=s),class:"w-full border rounded px-3 py-2 text-sm"},[t[26]||(t[26]=e("option",{disabled:"",value:0},"Select subject",-1)),(n(!0),o(c,null,p(i.value.subjects,s=>(n(),o("option",{key:s.id,value:s.id},d(s.name),9,fe))),128))],512),[[x,a.value.subject_id,void 0,{number:!0}]])]),e("div",_e,[t[28]||(t[28]=e("label",{class:"text-xs text-slate-600"},"Teacher ID (optional)",-1)),u(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>a.value.teacher_id=s),class:"w-full border rounded px-3 py-2 text-sm",placeholder:"Teacher id"},null,512),[[k,a.value.teacher_id,void 0,{number:!0}]]),t[29]||(t[29]=e("p",{class:"text-xs text-slate-500 mt-1"},"Tip: open Teachers page and use teacher id from list.",-1))])]),e("div",{class:"flex justify-end gap-2 pt-2"},[e("button",{class:"px-3 py-2 rounded border bg-white text-sm",onClick:C},"Cancel"),e("button",{class:"px-3 py-2 rounded bg-slate-900 text-white text-sm",onClick:B},"Save")]),v.value?(n(),o("p",{key:0,class:z(["text-sm",_.value?"text-green-700":"text-red-700"])},d(v.value),3)):j("",!0)])])):j("",!0)]))}};export{ge as default};
