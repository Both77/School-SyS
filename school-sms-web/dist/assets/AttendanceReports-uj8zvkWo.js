import{r as x,p as R,c as o,a as t,b as p,s as g,F as _,j as f,v as w,t as n,d as h,q as j,k as N,o as d,x as S}from"./index-Cz2jkUhJ.js";import{f as U}from"./masters-BuYwAPrL.js";const T={class:"p-6 space-y-4"},$={class:"bg-white rounded shadow p-4 grid gap-3 md:grid-cols-4"},L=["value"],V=["value"],O={key:0,class:"bg-white rounded shadow p-4"},P={class:"grid gap-4 md:grid-cols-4"},B={class:"text-center"},E={class:"text-2xl font-bold text-blue-600"},F={class:"text-center"},M={class:"text-2xl font-bold text-green-600"},I={class:"text-center"},q={class:"text-2xl font-bold text-red-600"},z={class:"text-center"},G={class:"text-2xl font-bold text-yellow-600"},H={class:"bg-white rounded shadow overflow-hidden"},J={class:"w-full text-sm"},K={class:"p-3"},Q={class:"p-3"},W={class:"p-3"},X={class:"p-3"},Y={class:"p-3"},Z={class:"p-3"},tt={class:"p-3"},et={key:0},nt={__name:"AttendanceReports",setup(st){const v=x({classes:[],sections:[],subjects:[]}),u=x([]),i=x(null),a=x({class_id:0,section_id:0,from_date:new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],to_date:new Date().toISOString().split("T")[0]}),C=N(()=>a.value.class_id?v.value.sections.filter(l=>l.class_id===a.value.class_id):v.value.sections);function A(l){return l>=90?"text-green-600 font-semibold":l>=75?"text-yellow-600 font-semibold":"text-red-600 font-semibold"}function D(l){return l>=90?"text-green-600":l>=75?"text-yellow-600":"text-red-600"}function b(l){return l>=90?"Excellent":l>=75?"Good":"Needs Attention"}async function c(){try{const l=new URLSearchParams;a.value.class_id&&l.append("class_id",a.value.class_id),a.value.section_id&&l.append("section_id",a.value.section_id),a.value.from_date&&l.append("from_date",a.value.from_date),a.value.to_date&&l.append("to_date",a.value.to_date);const{data:e}=await j.get(`/attendance/reports?${l}`);u.value=e.reports||[],i.value=e.summary||null}catch(l){console.error("Failed to load reports:",l),u.value=[],i.value=null}}function k(){if(u.value.length===0){alert("No data to export");return}const e=[["Student Name","Admission No","Class","Present Days","Total Days","Attendance %","Status"].join(","),...u.value.map(r=>[`"${r.student_name}"`,`"${r.admission_no}"`,`"${r.class_name}"`,r.present_days,r.total_days,`${r.attendance_percentage}%`,b(r.attendance_percentage)].join(","))].join(`
`),s=new Blob([e],{type:"text/csv"}),y=window.URL.createObjectURL(s),m=document.createElement("a");m.href=y,m.download=`attendance-report-${a.value.from_date}-to-${a.value.to_date}.csv`,m.click(),window.URL.revokeObjectURL(y)}return R(async()=>{v.value=await U().catch(()=>({classes:[],sections:[],subjects:[]})),await c()}),(l,e)=>(d(),o("div",T,[t("div",{class:"flex items-center justify-between"},[e[4]||(e[4]=t("h1",{class:"text-xl font-semibold"},"Attendance Reports",-1)),t("button",{class:"px-3 py-2 rounded bg-white border text-sm",onClick:c},"Refresh")]),t("div",$,[t("div",null,[e[6]||(e[6]=t("label",{class:"text-xs text-slate-600"},"Class",-1)),p(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>a.value.class_id=s),class:"w-full border rounded px-3 py-2 text-sm",onChange:c},[e[5]||(e[5]=t("option",{value:0},"All Classes",-1)),(d(!0),o(_,null,f(v.value.classes,s=>(d(),o("option",{key:s.id,value:s.id},n(s.name),9,L))),128))],544),[[g,a.value.class_id,void 0,{number:!0}]])]),t("div",null,[e[8]||(e[8]=t("label",{class:"text-xs text-slate-600"},"Section",-1)),p(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>a.value.section_id=s),class:"w-full border rounded px-3 py-2 text-sm",onChange:c},[e[7]||(e[7]=t("option",{value:0},"All Sections",-1)),(d(!0),o(_,null,f(C.value,s=>(d(),o("option",{key:s.id,value:s.id},n(s.name),9,V))),128))],544),[[g,a.value.section_id,void 0,{number:!0}]])]),t("div",null,[e[9]||(e[9]=t("label",{class:"text-xs text-slate-600"},"From Date",-1)),p(t("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=s=>a.value.from_date=s),class:"w-full border rounded px-3 py-2 text-sm",onChange:c},null,544),[[w,a.value.from_date]])]),t("div",null,[e[10]||(e[10]=t("label",{class:"text-xs text-slate-600"},"To Date",-1)),p(t("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=s=>a.value.to_date=s),class:"w-full border rounded px-3 py-2 text-sm",onChange:c},null,544),[[w,a.value.to_date]])])]),i.value?(d(),o("div",O,[e[15]||(e[15]=t("h2",{class:"text-lg font-semibold mb-4"},"Summary",-1)),t("div",P,[t("div",B,[t("div",E,n(i.value.total_students),1),e[11]||(e[11]=t("div",{class:"text-sm text-gray-600"},"Total Students",-1))]),t("div",F,[t("div",M,n(i.value.present_days),1),e[12]||(e[12]=t("div",{class:"text-sm text-gray-600"},"Present Days",-1))]),t("div",I,[t("div",q,n(i.value.absent_days),1),e[13]||(e[13]=t("div",{class:"text-sm text-gray-600"},"Absent Days",-1))]),t("div",z,[t("div",G,n(i.value.attendance_percentage)+"%",1),e[14]||(e[14]=t("div",{class:"text-sm text-gray-600"},"Average Attendance",-1))])])])):h("",!0),t("div",H,[e[18]||(e[18]=t("div",{class:"p-4 border-b"},[t("h2",{class:"text-lg font-semibold"},"Student-wise Attendance")],-1)),t("table",J,[e[17]||(e[17]=t("thead",{class:"bg-slate-50"},[t("tr",null,[t("th",{class:"text-left p-3"},"Student Name"),t("th",{class:"text-left p-3"},"Admission No"),t("th",{class:"text-left p-3"},"Class"),t("th",{class:"text-left p-3"},"Present Days"),t("th",{class:"text-left p-3"},"Total Days"),t("th",{class:"text-left p-3"},"Attendance %"),t("th",{class:"text-left p-3"},"Status")])],-1)),t("tbody",null,[(d(!0),o(_,null,f(u.value,s=>(d(),o("tr",{key:s.student_id,class:"border-t"},[t("td",K,n(s.student_name),1),t("td",Q,n(s.admission_no),1),t("td",W,n(s.class_name),1),t("td",X,n(s.present_days),1),t("td",Y,n(s.total_days),1),t("td",Z,[t("span",{class:S(A(s.attendance_percentage))},n(s.attendance_percentage)+"% ",3)]),t("td",tt,[t("span",{class:S(D(s.attendance_percentage))},n(b(s.attendance_percentage)),3)])]))),128)),u.value.length===0?(d(),o("tr",et,[...e[16]||(e[16]=[t("td",{class:"p-4 text-slate-500",colspan:7},"No attendance data found",-1)])])):h("",!0)])])]),t("div",{class:"flex justify-end"},[t("button",{class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm",onClick:k}," Export Report ")])]))}};export{nt as default};
