import{r as u,p as U,c as d,a as e,b as f,v as D,s as y,F as g,j as w,d as S,x as A,t as b,k as B,q as _,o}from"./index-Cz2jkUhJ.js";import{f as F}from"./masters-BuYwAPrL.js";const I={class:"p-6 space-y-4"},E={class:"bg-white rounded shadow p-4 grid gap-3 md:grid-cols-4"},L=["value"],N=["value"],O={key:0,class:"bg-white rounded shadow overflow-hidden"},q={class:"w-full text-sm"},z={class:"p-3"},R={class:"p-3"},T=["onUpdate:modelValue"],K={__name:"Mark",setup(G){const v=u(new Date().toISOString().slice(0,10)),n=u(0),r=u(0),c=u({classes:[],sections:[],subjects:[]}),M=u([]),p=u([]),i=u(""),m=u(!0),V=B(()=>n.value?c.value.sections.filter(a=>a.class_id===n.value):c.value.sections);async function k(){var a;c.value=await F().catch(()=>({classes:[],sections:[],subjects:[]})),n.value||(n.value=((a=c.value.classes[0])==null?void 0:a.id)||0)}async function h(){if(i.value="",!n.value){m.value=!1,i.value="Select a class";return}const a=await _.get("/students"),t=a.data.data??a.data;M.value=t;const s=t.filter(l=>l.class_id===n.value&&(!r.value||l.section_id===r.value));let x=[];try{const{data:l}=await _.get("/attendance/list",{params:{date:v.value,class_id:n.value,section_id:r.value||void 0}});x=l}catch{}const j=new Map(x.map(l=>[l.student_id,l.status]));p.value=s.map(l=>({student_id:l.id,name:l.name,status:j.get(l.id)||"present"}))}async function C(){var a,t;i.value="";try{await _.post("/attendance/mark",{date:v.value,class_id:n.value,section_id:r.value||null,items:p.value.map(s=>({student_id:s.student_id,status:s.status}))}),m.value=!0,i.value="Attendance saved!"}catch(s){m.value=!1,i.value=((t=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to save attendance"}}return U(async()=>{await k()}),(a,t)=>(o(),d("div",I,[e("div",{class:"flex items-center justify-between"},[t[3]||(t[3]=e("h1",{class:"text-xl font-semibold"},"Mark Attendance",-1)),e("button",{class:"px-3 py-2 rounded bg-white border text-sm",onClick:k},"Reload Masters")]),e("div",E,[e("div",null,[t[4]||(t[4]=e("label",{class:"text-xs text-slate-600"},"Date",-1)),f(e("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=s=>v.value=s),class:"w-full border rounded px-3 py-2 text-sm"},null,512),[[D,v.value]])]),e("div",null,[t[6]||(t[6]=e("label",{class:"text-xs text-slate-600"},"Class",-1)),f(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>n.value=s),class:"w-full border rounded px-3 py-2 text-sm"},[t[5]||(t[5]=e("option",{disabled:"",value:0},"Select class",-1)),(o(!0),d(g,null,w(c.value.classes,s=>(o(),d("option",{key:s.id,value:s.id},b(s.name),9,L))),128))],512),[[y,n.value,void 0,{number:!0}]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"text-xs text-slate-600"},"Section",-1)),f(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>r.value=s),class:"w-full border rounded px-3 py-2 text-sm"},[t[7]||(t[7]=e("option",{value:0},"All",-1)),(o(!0),d(g,null,w(V.value,s=>(o(),d("option",{key:s.id,value:s.id},b(s.name),9,N))),128))],512),[[y,r.value,void 0,{number:!0}]])]),e("div",{class:"flex items-end gap-2"},[e("button",{class:"px-3 py-2 rounded bg-slate-900 text-white text-sm w-full",onClick:h}," Load ")])]),p.value.length?(o(),d("div",O,[e("table",q,[t[10]||(t[10]=e("thead",{class:"bg-slate-50"},[e("tr",null,[e("th",{class:"text-left p-3"},"Student"),e("th",{class:"text-left p-3"},"Status")])],-1)),e("tbody",null,[(o(!0),d(g,null,w(p.value,s=>(o(),d("tr",{key:s.student_id,class:"border-t"},[e("td",z,b(s.name),1),e("td",R,[f(e("select",{"onUpdate:modelValue":x=>s.status=x,class:"border rounded px-2 py-1 text-sm"},[...t[9]||(t[9]=[e("option",{value:"present"},"present",-1),e("option",{value:"absent"},"absent",-1),e("option",{value:"late"},"late",-1)])],8,T),[[y,s.status]])])]))),128))])]),e("div",{class:"p-3 border-t flex items-center justify-end gap-3"},[e("button",{class:"px-3 py-2 rounded bg-slate-900 text-white text-sm",onClick:C},"Save")])])):S("",!0),i.value?(o(),d("p",{key:1,class:A(["text-sm",m.value?"text-green-700":"text-red-700"])},b(i.value),3)):S("",!0)]))}};export{K as default};
