import{u as I,p as T,c as a,a as t,d as m,b as d,s as y,F as w,j as g,v as x,t as u,x as z,r as i,q as S,k as V,o}from"./index-Cz2jkUhJ.js";import{f as R}from"./masters-BuYwAPrL.js";const H={class:"p-6 space-y-4"},J={class:"flex items-center justify-between"},K={class:"flex items-center gap-2"},P={class:"bg-white rounded shadow p-4 grid gap-3 md:grid-cols-3"},Q=["value"],W=["value"],X={class:"bg-white rounded shadow overflow-hidden"},Y={class:"w-full text-sm"},Z={class:"bg-slate-50"},ee={key:0,class:"text-left p-3"},te={class:"p-3"},se={class:"p-3"},le={class:"p-3"},ne={class:"p-3"},ae={key:0,class:"p-3"},oe=["onClick"],de=["onClick"],ue={key:0},ie=["colspan"],re={key:0,class:"fixed inset-0 bg-black/40 flex items-center justify-center p-4"},ve={class:"bg-white rounded shadow w-full max-w-lg p-4 space-y-3"},pe={class:"flex items-center justify-between"},me={class:"font-semibold"},xe={class:"grid gap-3 md:grid-cols-2"},ce=["value"],fe=["value"],be={class:"md:col-span-2"},_e={__name:"Index",setup(ye){const M=I(),_=V(()=>{var l;return((l=M.user)==null?void 0:l.role)==="admin"}),r=i({classes:[],sections:[],subjects:[]}),A=i([]),p=i(0),k=i(0),U=i(""),c=i(!1),f=i(null),n=i({admission_no:"",name:"",class_id:0,section_id:null,dob:"",gender:"",guardian_phone:"",address:""}),v=i(""),b=i(!0),$=V(()=>p.value?r.value.sections.filter(l=>l.class_id===p.value):r.value.sections),B=V(()=>n.value.class_id?r.value.sections.filter(l=>l.class_id===n.value.class_id):[]),N=V(()=>{const l=U.value.trim().toLowerCase();return A.value.filter(e=>p.value&&e.class_id!==p.value||k.value&&e.section_id!==k.value?!1:l?(e.name||"").toLowerCase().includes(l)||(e.admission_no||"").toLowerCase().includes(l):!0)});function E(){var l;n.value={admission_no:"",name:"",class_id:((l=r.value.classes[0])==null?void 0:l.id)||0,section_id:null,dob:"",gender:"",guardian_phone:"",address:""}}function L(){v.value="",b.value=!0,f.value=null,E(),c.value=!0}function O(l){v.value="",b.value=!0,f.value=l.id,n.value={admission_no:l.admission_no,name:l.name,class_id:l.class_id,section_id:l.section_id,dob:l.dob||"",gender:l.gender||"",guardian_phone:l.guardian_phone||"",address:l.address||""},c.value=!0}function j(){c.value=!1}async function C(){const{data:l}=await S.get("/students");A.value=l.data??l}async function h(){var l,e;v.value="";try{const s={...n.value};s.section_id||(s.section_id=null),f.value?await S.put(`/students/${f.value}`,s):await S.post("/students",s),b.value=!0,v.value="Saved!",await C(),setTimeout(()=>c.value=!1,400)}catch(s){b.value=!1,v.value=((e=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:e.message)||"Save failed"}}async function q(l){if(confirm(`Delete ${l.name}?`))try{await S.delete(`/students/${l.id}`),await C()}catch{alert("Delete failed")}}return T(async()=>{r.value=await R().catch(()=>({classes:[],sections:[],subjects:[]})),await C()}),(l,e)=>(o(),a("div",H,[t("div",J,[e[11]||(e[11]=t("h1",{class:"text-xl font-semibold"},"Students",-1)),t("div",K,[t("button",{class:"px-3 py-2 rounded bg-white border text-sm",onClick:C},"Refresh"),_.value?(o(),a("button",{key:0,class:"px-3 py-2 rounded bg-slate-900 text-white text-sm",onClick:L}," + Add Student ")):m("",!0)])]),t("div",P,[t("div",null,[e[13]||(e[13]=t("label",{class:"text-xs text-slate-600"},"Class",-1)),d(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>p.value=s),class:"w-full border rounded px-3 py-2 text-sm"},[e[12]||(e[12]=t("option",{value:0},"All",-1)),(o(!0),a(w,null,g(r.value.classes,s=>(o(),a("option",{key:s.id,value:s.id},u(s.name),9,Q))),128))],512),[[y,p.value,void 0,{number:!0}]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"text-xs text-slate-600"},"Section",-1)),d(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>k.value=s),class:"w-full border rounded px-3 py-2 text-sm"},[e[14]||(e[14]=t("option",{value:0},"All",-1)),(o(!0),a(w,null,g($.value,s=>(o(),a("option",{key:s.id,value:s.id},u(s.name),9,W))),128))],512),[[y,k.value,void 0,{number:!0}]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"text-xs text-slate-600"},"Search (name/admission)",-1)),d(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>U.value=s),class:"w-full border rounded px-3 py-2 text-sm",placeholder:"Search..."},null,512),[[x,U.value]])])]),t("div",X,[t("table",Y,[t("thead",Z,[t("tr",null,[e[17]||(e[17]=t("th",{class:"text-left p-3"},"Name",-1)),e[18]||(e[18]=t("th",{class:"text-left p-3"},"Admission No",-1)),e[19]||(e[19]=t("th",{class:"text-left p-3"},"Class",-1)),e[20]||(e[20]=t("th",{class:"text-left p-3"},"Section",-1)),_.value?(o(),a("th",ee,"Action")):m("",!0)])]),t("tbody",null,[(o(!0),a(w,null,g(N.value,s=>{var D,F;return o(),a("tr",{key:s.id,class:"border-t"},[t("td",te,u(s.name),1),t("td",se,u(s.admission_no),1),t("td",le,u((D=s.class)==null?void 0:D.name),1),t("td",ne,u(((F=s.section)==null?void 0:F.name)||"-"),1),_.value?(o(),a("td",ae,[t("button",{class:"text-blue-700",onClick:G=>O(s)},"Edit",8,oe),e[21]||(e[21]=t("span",{class:"mx-2 text-slate-300"},"|",-1)),t("button",{class:"text-red-700",onClick:G=>q(s)},"Delete",8,de)])):m("",!0)])}),128)),N.value.length===0?(o(),a("tr",ue,[t("td",{class:"p-4 text-slate-500",colspan:_.value?5:4},"No students",8,ie)])):m("",!0)])])]),c.value?(o(),a("div",re,[t("div",ve,[t("div",pe,[t("h2",me,u(f.value?"Edit Student":"Add Student"),1),t("button",{class:"text-slate-600",onClick:j},"âœ•")]),t("div",xe,[t("div",null,[e[22]||(e[22]=t("label",{class:"text-xs text-slate-600"},"Name",-1)),d(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>n.value.name=s),class:"w-full border rounded px-3 py-2 text-sm"},null,512),[[x,n.value.name]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"text-xs text-slate-600"},"Admission No",-1)),d(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>n.value.admission_no=s),class:"w-full border rounded px-3 py-2 text-sm"},null,512),[[x,n.value.admission_no]])]),t("div",null,[e[25]||(e[25]=t("label",{class:"text-xs text-slate-600"},"Class",-1)),d(t("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>n.value.class_id=s),class:"w-full border rounded px-3 py-2 text-sm"},[e[24]||(e[24]=t("option",{disabled:"",value:0},"Select class",-1)),(o(!0),a(w,null,g(r.value.classes,s=>(o(),a("option",{key:s.id,value:s.id},u(s.name),9,ce))),128))],512),[[y,n.value.class_id,void 0,{number:!0}]])]),t("div",null,[e[27]||(e[27]=t("label",{class:"text-xs text-slate-600"},"Section",-1)),d(t("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>n.value.section_id=s),class:"w-full border rounded px-3 py-2 text-sm"},[e[26]||(e[26]=t("option",{value:null},"None",-1)),(o(!0),a(w,null,g(B.value,s=>(o(),a("option",{key:s.id,value:s.id},u(s.name),9,fe))),128))],512),[[y,n.value.section_id,void 0,{number:!0}]])]),t("div",null,[e[28]||(e[28]=t("label",{class:"text-xs text-slate-600"},"DOB",-1)),d(t("input",{type:"date","onUpdate:modelValue":e[7]||(e[7]=s=>n.value.dob=s),class:"w-full border rounded px-3 py-2 text-sm"},null,512),[[x,n.value.dob]])]),t("div",null,[e[30]||(e[30]=t("label",{class:"text-xs text-slate-600"},"Gender",-1)),d(t("select",{"onUpdate:modelValue":e[8]||(e[8]=s=>n.value.gender=s),class:"w-full border rounded px-3 py-2 text-sm"},[...e[29]||(e[29]=[t("option",{value:""},"-",-1),t("option",null,"male",-1),t("option",null,"female",-1),t("option",null,"other",-1)])],512),[[y,n.value.gender]])]),t("div",null,[e[31]||(e[31]=t("label",{class:"text-xs text-slate-600"},"Guardian phone",-1)),d(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>n.value.guardian_phone=s),class:"w-full border rounded px-3 py-2 text-sm"},null,512),[[x,n.value.guardian_phone]])]),t("div",be,[e[32]||(e[32]=t("label",{class:"text-xs text-slate-600"},"Address",-1)),d(t("textarea",{"onUpdate:modelValue":e[10]||(e[10]=s=>n.value.address=s),class:"w-full border rounded px-3 py-2 text-sm",rows:"2"},null,512),[[x,n.value.address]])])]),t("div",{class:"flex justify-end gap-2 pt-2"},[t("button",{class:"px-3 py-2 rounded border bg-white text-sm",onClick:j},"Cancel"),t("button",{class:"px-3 py-2 rounded bg-slate-900 text-white text-sm",onClick:h}," Save ")]),v.value?(o(),a("p",{key:0,class:z(["text-sm",b.value?"text-green-700":"text-red-700"])},u(v.value),3)):m("",!0)])])):m("",!0)]))}};export{_e as default};
